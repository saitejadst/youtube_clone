trigger:
- main

stages:
# ---------------- BUILD STAGE ----------------
- stage: Build
  displayName: Build Stage
  jobs:
  - job: Build
    displayName: Build Job
    pool:
      vmImage: ubuntu-latest

    steps:
    - task: Npm@1
      displayName: Install dependencies
      inputs:
        command: install

    - task: Npm@1
      displayName: Build application
      inputs:
        command: custom
        customCommand: run build

    - task: PublishBuildArtifacts@1
      displayName: Publish build artifacts
      inputs:
        PathtoPublish: build
        ArtifactName: drop
        publishLocation: Container

# ---------------- DEPLOY STAGE ----------------
- stage: Deploy
  displayName: Deploy Stage
  dependsOn: Build
  jobs:
  - job: Deploy
    displayName: Deploy Job
    pool:
      vmImage: ubuntu-latest
    steps:
    - task: DownloadBuildArtifacts@1
      inputs:
        buildType: 'current'
        downloadType: 'single'
        artifactName: 'drop'
        downloadPath: '$(System.ArtifactsDirectory)'
    - task: AzureRmWebAppDeployment@5
      displayName: Deploy to Azure Web App
      inputs:
        ConnectionType: AzureRM
        azureSubscription: 'Azure subscription 1 (505fe92d-2c15-4333-93d2-d0865131af43)'
        appType: webAppLinux
        WebAppName: youtube
        packageForLinux: $(System.ArtifactsDirectory)/drop
        RuntimeStack: NODE|18-lts
        DeploymentTypeLinux: oneDeploy
